<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Player</title>
    <style>
        body {
            background: #000;
            color: white;
            font-family: Arial;
            text-align: center;
            margin: 0;
        }
        h1 {
            margin: 20px;
            color: #ff3366;
        }
        iframe {
            width: 100%;
            height: 80vh;
            border: none;
        }
    </style>
</head>
<body>

<h1 id="title">Loading...</h1>

<iframe id="player" allowfullscreen></iframe>

<p>If video doesnâ€™t load, the file may be private.</p>

<script>
    const p = new URLSearchParams(window.location.search);
    const title = p.get("title");
    const mega = p.get("mega");

    document.getElementById("title").textContent = title;

    function convertToEmbed(url) {
        if (!url) return null;

        // Works for ALL formats:
        // mega.nz/file/XXXX#KEY
        // mega.nz/folder/XXXX#KEY
        // mega.nz/embed/XXXX#KEY
        // mega.nz/xxxx/xxxx?id=123

        try {
            let cleaned = url.replace("https://", "").replace("http://", "");

            // Get ID
            let id = cleaned.split("/file/")[1];
            if (id) id = id.split("#")[0];

            // Fallback for folder links
            if (!id && cleaned.includes("/folder/")) {
                id = cleaned.split("/folder/")[1].split("#")[0];
            }

            // Get KEY
            let key = cleaned.split("#")[1];

            if (!id || !key) return null;

            return `https://megaembed.net/embed/${id}#${key}`;
        } catch {
            return null;
        }
    }

    const embedLink = convertToEmbed(mega);

    if (embedLink) {
        document.getElementById("player").src = embedLink;
    } else {
        document.body.innerHTML += "<p style='color:red;'>Failed to read MEGA link!</p>";
    }
</script>

</body>
</html>
